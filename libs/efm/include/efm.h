/************************************************************************

    efm.h

    EFM-library - EFM conversion functions
    Copyright (C) 2025 Simon Inns

    This file is part of ld-decode-tools.

    ld-efm-decoder is free software: you can redistribute it and/or
    modify it under the terms of the GNU General Public License as
    published by the Free Software Foundation, either version 3 of the
    License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.

************************************************************************/

#ifndef EFM_H
#define EFM_H

#include <cstdint>
#include <QString>
#include <QStringList>
#include <QDebug>
#include <QHash>

class Efm {
public:
    Efm();
    
    uint16_t fourteen_to_eight(QString efm);
    QString eight_to_fourteen(uint16_t value);

private:
    QHash<QString, uint16_t> efmHash;

    // Note: The EFM LUT is a list of 257 EFM symbols, each represented as a 14-bit string
    // The EFM symbols are indexed from 0 to 257 with the first 256 symbols representing
    // the 8-bit data values from 0 to 255 and the last symbols representing the sync header
    // sync0 and sync1 respectively.
    const QStringList efm_lut = {
        "01001000100000", "10000100000000", "10010000100000", "10001000100000",
        "01000100000000", "00000100010000", "00010000100000", "00100100000000",
        "01001001000000", "10000001000000", "10010001000000", "10001001000000",
        "01000001000000", "00000001000000", "00010001000000", "00100001000000",
        "10000000100000", "10000010000000", "10010010000000", "00100000100000",
        "01000010000000", "00000010000000", "00010010000000", "00100010000000",
        "01001000010000", "10000000010000", "10010000010000", "10001000010000",
        "01000000010000", "00001000010000", "00010000010000", "00100000010000",
        "00000000100000", "10000100001000", "00001000100000", "00100100100000",
        "01000100001000", "00000100001000", "01000000100000", "00100100001000",
        "01001001001000", "10000001001000", "10010001001000", "10001001001000",
        "01000001001000", "00000001001000", "00010001001000", "00100001001000",
        "00000100000000", "10000010001000", "10010010001000", "10000100010000",
        "01000010001000", "00000010001000", "00010010001000", "00100010001000",
        "01001000001000", "10000000001000", "10010000001000", "10001000001000",
        "01000000001000", "00001000001000", "00010000001000", "00100000001000",
        "01001000100100", "10000100100100", "10010000100100", "10001000100100",
        "01000100100100", "00000000100100", "00010000100100", "00100100100100",
        "01001001000100", "10000001000100", "10010001000100", "10001001000100",
        "01000001000100", "00000001000100", "00010001000100", "00100001000100",
        "10000000100100", "10000010000100", "10010010000100", "00100000100100",
        "01000010000100", "00000010000100", "00010010000100", "00100010000100",
        "01001000000100", "10000000000100", "10010000000100", "10001000000100",
        "01000000000100", "00001000000100", "00010000000100", "00100000000100",
        "01001000100010", "10000100100010", "10010000100010", "10001000100010",
        "01000100100010", "00000000100010", "01000000100100", "00100100100010",
        "01001001000010", "10000001000010", "10010001000010", "10001001000010",
        "01000001000010", "00000001000010", "00010001000010", "00100001000010",
        "10000000100010", "10000010000010", "10010010000010", "00100000100010",
        "01000010000010", "00000010000010", "00010010000010", "00100010000010",
        "01001000000010", "00001001001000", "10010000000010", "10001000000010",
        "01000000000010", "00001000000010", "00010000000010", "00100000000010",
        "01001000100001", "10000100100001", "10010000100001", "10001000100001",
        "01000100100001", "00000000100001", "00010000100001", "00100100100001",
        "01001001000001", "10000001000001", "10010001000001", "10001001000001",
        "01000001000001", "00000001000001", "00010001000001", "00100001000001",
        "10000000100001", "10000010000001", "10010010000001", "00100000100001",
        "01000010000001", "00000010000001", "00010010000001", "00100010000001",
        "01001000000001", "10000010010000", "10010000000001", "10001000000001",
        "01000010010000", "00001000000001", "00010000000001", "00100010010000",
        "00001000100001", "10000100001001", "01000100010000", "00000100100001",
        "01000100001001", "00000100001001", "01000000100001", "00100100001001",
        "01001001001001", "10000001001001", "10010001001001", "10001001001001",
        "01000001001001", "00000001001001", "00010001001001", "00100001001001",
        "00000100100000", "10000010001001", "10010010001001", "00100100010000",
        "01000010001001", "00000010001001", "00010010001001", "00100010001001",
        "01001000001001", "10000000001001", "10010000001001", "10001000001001",
        "01000000001001", "00001000001001", "00010000001001", "00100000001001",
        "01000100100000", "10000100010001", "10010010010000", "00001000100100",
        "01000100010001", "00000100010001", "00010010010000", "00100100010001",
        "00001001000001", "10000100000001", "00001001000100", "00001001000000",
        "01000100000001", "00000100000001", "00000010010000", "00100100000001",
        "00000100100100", "10000010010001", "10010010010001", "10000100100000",
        "01000010010001", "00000010010001", "00010010010001", "00100010010001",
        "01001000010001", "10000000010001", "10010000010001", "10001000010001",
        "01000000010001", "00001000010001", "00010000010001", "00100000010001",
        "01000100000010", "00000100000010", "10000100010010", "00100100000010",
        "01000100010010", "00000100010010", "01000000100010", "00100100010010",
        "10000100000010", "10000100000100", "00001001001001", "00001001000010",
        "01000100000100", "00000100000100", "00010000100010", "00100100000100",
        "00000100100010", "10000010010010", "10010010010010", "00001000100010",
        "01000010010010", "00000010010010", "00010010010010", "00100010010010",
        "01001000010010", "10000000010010", "10010000010010", "10001000010010",
        "01000000010010", "00001000010010", "00010000010010", "00100000010010",
        "00100000000001", "00000000010010"
    };
};

#endif // EFM_H